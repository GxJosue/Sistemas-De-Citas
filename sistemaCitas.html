<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Citas - Barber铆a</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #B0B0B0;
            margin: 0;
            padding: 0;
        }
        .header {
            background-color: #333;
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .header img {
            width: 150px;
            height: auto;
        }
        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        }
        .hora-disponible, .hora-ocupada, button {
            padding: 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .hora-disponible {
            background-color: rgb(151, 153, 151);
        }
        .hora-ocupada {
            background-color: lightcoral;
            color: #000000;
            cursor: not-allowed;
        }
        .lista-citas {
            margin-top: 20px;
            text-align: left;
        }
        .editar-btn {
            background-color: #007bff;
            color: white;
        }
        .eliminar-btn {
            background-color: #dc3545;
            color: white;
        }

        /* Estilos para el modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
}

.modal-contenido {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    width: 80%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
}

.modal input {
    width: 90%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.modal-botones {
    margin-top: 10px;
}

.modal-botones button {
    padding: 10px 15px;
    margin: 5px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.btn-confirmar {
    background-color: #28a745;
    color: white;
}

.btn-cancelar {
    background-color: #dc3545;
    color: white;
}

/* Estilos para el modal de confirmaci贸n */
#modal-confirmacion {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
}

#modal-confirmacion .modal-contenido {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    width: 80%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
}

#modal-confirmacion .modal-botones {
    margin-top: 10px;
}

#modal-confirmacion .btn-confirmar {
    background-color: #28a745;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
/* Estilos para el modal de edici贸n */
#modal-editar {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
}

#modal-editar .modal-contenido {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    width: 80%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
}

#modal-editar input {
    width: 90%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
}

#modal-editar .modal-botones {
    margin-top: 10px;
}

#modal-editar .btn-confirmar {
    background-color: #007bff;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

#modal-editar .btn-cancelar {
    background-color: #dc3545;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

    </style>
</head>
<body>
    <div class="header">
        <img src="img/logo.webp" alt="Logo">
        <h1>Barber铆a Free Style - Citas disponibles</h1>
    </div>

    <div class="container">
        <h2>Selecciona un horario disponible</h2>
        <div id="horarios"></div>
        <h3>Citas Agendadas</h3>
        <ul id="lista-citas" class="lista-citas"></ul>
    </div>

    <script type="module">
        // Importar Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

        // Configuraci贸n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDeSHWfxU-lU-ID4YvaQQm479CADhXowWE",
            authDomain: "barberiacitas-94e43.firebaseapp.com",
            projectId: "barberiacitas-94e43",
            storageBucket: "barberiacitas-94e43.firebasestorage.app",
            messagingSenderId: "113964486737",
            appId: "1:113964486737:web:c513937562113309d5e870",
            measurementId: "G-ZQ4LV7M646"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Horarios disponibles
        const horarios = [
            "7:00 AM", "8:00 AM", "9:00 AM", "10:00 AM", "11:00 AM", "12:00 PM",
            "1:00 PM", "2:00 PM", "3:00 PM", "4:00 PM", "5:00 PM", "6:00 PM"
        ];

        let userId = localStorage.getItem("userId");
        if (!userId) {
            userId = "user-" + Math.random().toString(36).substr(2, 9);
            localStorage.setItem("userId", userId);
        }

        // Cargar horarios
        function cargarHorarios() {
            const contenedor = document.getElementById("horarios");
            contenedor.innerHTML = "";

            onSnapshot(collection(db, "citas"), (snapshot) => {
                let citasGuardadas = snapshot.docs.map(doc => doc.data());

                contenedor.innerHTML = "";

                horarios.forEach(hora => {
                    const btn = document.createElement("button");
                    btn.textContent = hora;
                    let citaExistente = citasGuardadas.find(cita => cita.hora === hora);

                    if (citaExistente) {
                        btn.classList.add("hora-ocupada");
                        btn.disabled = true;
                    } else {
                        btn.classList.add("hora-disponible");
                        btn.onclick = () => agendarCita(hora);
                    }
                    contenedor.appendChild(btn);
                });
            });

            cargarListaCitas();
        }

        // Agendar cita
        let horaSeleccionada = ""; // Para almacenar la hora seleccionada

function agendarCita(hora) {
    horaSeleccionada = hora;
    document.getElementById("modal").style.display = "flex";
}

// Confirmar y guardar la cita
window.confirmarCita = async function () {
    let nombre = document.getElementById("nombre").value.trim();
    let telefono = document.getElementById("telefono").value.trim();

    if (!nombre || !telefono) {
        alert("Debe ingresar un nombre y un n煤mero v谩lido.");
        return;
    }

    let cita = { hora: horaSeleccionada, nombre, telefono, userId };
    await addDoc(collection(db, "citas"), cita);

    cerrarModal(); // Cierra el modal de agendar

    // Mostrar modal de confirmaci贸n
    document.getElementById("modal-confirmacion").style.display = "flex";
};

// Cerrar modal de confirmaci贸n al hacer clic en "Aceptar"
document.getElementById("cerrar-confirmacion").addEventListener("click", () => {
    document.getElementById("modal-confirmacion").style.display = "none";
});



// Cerrar el modal
function cerrarModal() {
    document.getElementById("modal").style.display = "none";
    document.getElementById("nombre").value = "";
    document.getElementById("telefono").value = "";
}


// Cargar lista de citas
function cargarListaCitas() {
    const listaCitas = document.getElementById("lista-citas");
    listaCitas.innerHTML = "";

    onSnapshot(collection(db, "citas"), (snapshot) => {
        listaCitas.innerHTML = "";
        snapshot.forEach(docSnap => {
            let cita = docSnap.data();
            let citaId = docSnap.id;

            let li = document.createElement("li");
            li.textContent = `${cita.nombre || "No disponible"} - ${cita.telefono || "No disponible"} - ${cita.hora || "No disponible"}`;

            if (cita.userId === userId) {
                const btnEditar = document.createElement("button");
                btnEditar.textContent = "Editar";
                btnEditar.classList.add("editar-btn");
                btnEditar.onclick = () => editarCita(citaId, cita.nombre || "", cita.telefono || "");

                const btnEliminar = document.createElement("button");
                btnEliminar.textContent = "Eliminar";
                btnEliminar.classList.add("eliminar-btn");
                btnEliminar.onclick = () => eliminarCita(citaId);

                li.appendChild(btnEditar);
                li.appendChild(btnEliminar);
            }

            listaCitas.appendChild(li);
        });
    });
}
// Editar cita
window.editarCita = function (id, nombre, telefono) {
    let modalEditar = document.getElementById("modal-editar");
    let inputNombre = document.getElementById("editar-nombre");
    let inputTelefono = document.getElementById("editar-telefono");

    inputNombre.value = nombre || "";
    inputTelefono.value = telefono || "";

    modalEditar.style.display = "flex";

    document.getElementById("guardar-edicion").onclick = async function () {
        let nuevoNombre = inputNombre.value.trim();
        let nuevoTelefono = inputTelefono.value.trim();

        if (!nuevoNombre || !nuevoTelefono) {
            alert("Debe ingresar un nombre y un n煤mero v谩lido.");
            return;
        }

        try {
            await updateDoc(doc(db, "citas", id), {
                nombre: nuevoNombre,
                telefono: nuevoTelefono
            });

            modalEditar.style.display = "none"; // Cierra el modal de edici贸n

            //  MOSTRAR EL MODAL EN VEZ DE ALERTA
            let modalConfirmacion = document.getElementById("modal-confirmacion-edicion");
            modalConfirmacion.style.display = "flex";

        } catch (error) {
            console.error("Error al actualizar cita:", error);
        }
    };
};

// Cerrar el modal de confirmaci贸n al hacer clic en "Aceptar"
document.getElementById("cerrar-confirmacion-edicion").addEventListener("click", () => {
    document.getElementById("modal-confirmacion-edicion").style.display = "none";
});


// Cerrar modal de edici贸n al hacer clic en "Cancelar"
document.getElementById("cancelar-edicion").addEventListener("click", () => {
    document.getElementById("modal-editar").style.display = "none";
});


// Cerrar modal de edici贸n al hacer clic en "Cancelar"
document.getElementById("cancelar-edicion").addEventListener("click", () => {
    document.getElementById("modal-editar").style.display = "none";
});

// Funci贸n para eliminar cita con modal de confirmaci贸n
window.eliminarCita = function (id) {
    let modalEliminar = document.getElementById("modal-eliminar");
    modalEliminar.style.display = "flex";

    // Cuando el usuario confirma la eliminaci贸n
    document.getElementById("confirmar-eliminar").onclick = async function () {
        try {
            await deleteDoc(doc(db, "citas", id));

            modalEliminar.style.display = "none"; // Cierra el modal de confirmaci贸n

            //  Mostrar el modal de eliminaci贸n exitosa
            let modalEliminacionExitosa = document.getElementById("modal-eliminacion-exitosa");
            modalEliminacionExitosa.style.display = "flex";

        } catch (error) {
            console.error("Error al eliminar cita:", error);
        }
    };
};

// Cancelar la eliminaci贸n
document.getElementById("cancelar-eliminar").addEventListener("click", () => {
    document.getElementById("modal-eliminar").style.display = "none";
});

// Cerrar el modal de eliminaci贸n exitosa
document.getElementById("cerrar-eliminacion-exitosa").addEventListener("click", () => {
    document.getElementById("modal-eliminacion-exitosa").style.display = "none";
});


        window.onload = cargarHorarios;
    </script>

<div id="modal" class="modal">
    <div class="modal-contenido">
        <h2>Agendar Cita</h2>
        <input type="text" id="nombre" placeholder="Ingrese su nombre">
        <input type="tel" id="telefono" placeholder="Ingrese su tel茅fono">
        <div class="modal-botones">
            <button class="btn-confirmar" onclick="confirmarCita()">Confirmar</button>
            <button class="btn-cancelar" onclick="cerrarModal()">Cancelar</button>
        </div>
    </div>
</div>

<div id="modal-confirmacion" class="modal">
    <div class="modal-contenido">
        <p id="mensaje-confirmacion">Cita agendada correctamente.</p>
        <div class="modal-botones">
            <button id="cerrar-confirmacion" class="btn-confirmar">Aceptar</button>
        </div>
    </div> 
</div>
<div id="modal-editar" class="modal">
    <div class="modal-contenido">
        <p>Editar cita</p>
        <input type="text" id="editar-nombre" placeholder="Nombre">
        <input type="text" id="editar-telefono" placeholder="Tel茅fono">
        <div class="modal-botones">
            <button id="guardar-edicion" class="btn-confirmar">Guardar</button>
            <button id="cancelar-edicion" class="btn-cancelar">Cancelar</button>
        </div>
    </div>
</div>
<!-- Modal de confirmaci贸n despu茅s de editar -->
<div id="modal-confirmacion-edicion" class="modal">
    <div class="modal-contenido">
        <p>Cita actualizada correctamente.</p>
        <div class="modal-botones">
            <button id="cerrar-confirmacion-edicion" class="btn-confirmar">Aceptar</button>
        </div>
    </div>
</div>
<!-- Modal de confirmaci贸n de eliminaci贸n -->
<div id="modal-eliminar" class="modal">
    <div class="modal-contenido">
        <p>驴Seguro que deseas eliminar esta cita?</p>
        <div class="modal-botones">
            <button id="confirmar-eliminar" class="btn-confirmar">S铆, eliminar</button>
            <button id="cancelar-eliminar" class="btn-cancelar">Cancelar</button>
        </div>
    </div>
</div>

<!-- Modal de cita eliminada -->
<div id="modal-eliminacion-exitosa" class="modal">
    <div class="modal-contenido">
        <p>Cita eliminada correctamente.</p>
        <div class="modal-botones">
            <button id="cerrar-eliminacion-exitosa" class="btn-confirmar">Aceptar</button>
        </div>
    </div>
</div>

</body>
</html>
